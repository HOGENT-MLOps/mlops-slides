<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />

    <title>1. Docker</title>
    <link rel="shortcut icon" href="./favicon.ico" />
    <link rel="stylesheet" href="./dist/reset.css" />
    <link rel="stylesheet" href="./dist/reveal.css" />
    <link rel="stylesheet" href="./_assets/theme.css" id="theme" />
    <link rel="stylesheet" href="./css/highlight/vs.css" />

  </head>
  <body>
    <div class="reveal">
      <div class="slides">
        <section data-markdown data-separator="^\s*---\s*$" data-separator-vertical="^\s*-v-\s*$">
          <textarea data-template>
            

# Container virtualization: Docker

---

## Learning goals

- Understanding the concept of container virtualization
- Understanding the basic building blocks of Docker
- Understanding the concept of Docker Compose
- Being able to build Docker images and run them as Docker containers
- Being able to use Docker features like port bindings, volumes, environment variables...
- Being able to manage multiple containers using Docker Compose
- Being able to push Docker images to a Docker registry

---

# Docker

---

## Deployment (r)evolution

![<small><em>Source: <https://kubernetes.io/docs/concepts/overview/></em></small>](img/03-kubernetes/container_evolution.svg)

---

## What is Docker?

- Open source
- Container virtualization platform
  - Build, run and manage containers
- Uses host OS kernel

---

## What is a container?

- Executable version of a Docker image
- Isolated environment
  - Own filesystem
  - Own network
  - Own process tree
- Uses kernel namespaces, cgroups...
- Runs everywhere the same

---

## What is a container image?

- Read-only template
- Contains all the dependencies
  - Configurations, scripts, binaries...
- Contains metadata:
  - Name, version, environment variables...

---

## Why are containers so popular?

- CI/CD: easy to switch to previous versions (= images)
- decouple application from infrastructure
- environmental consistency: runs the same on your pc as in the cloud
- resource isolation: predictable application performance
- resource utilization: high efficiency and density
- ...

---

# Docker building blocks

---

## Port bindings

- By default: isolated network
  - More than one network is possible
- Expose container port to host

```bash
docker run -p 8080:80 nginx
```

---

## Volumes

![](img/01-docker/types-of-mounts-volume.png)

<em>Source: <https://docs.docker.com/storage/volumes/></em>

---

## Volumes: volume

- Managed by Docker
- Resides in the *Docker area*

```bash
docker run -v volume_name:/path/in/container nginx
```

---

## Volumes: bind mount

- Folder on host mounted in container
- Folder can be anywhere on host

```bash
docker run -v /path/on/host:/path/in/container nginx
```

---

## Volumes: tmpfs mount

- Mount a temporary filesystem
- Resides in memory
- Data is not persistent

```bash
docker run --mount type=tmpfs,destination=/path/in/container nginx
```

---

## Docker Compose

- Define and run multi-container Docker applications
- Config: `docker-compose.yml`

---

## Example: `docker-compose.yml`

```yaml
services:
  redis:
    image: redis:alpine
    ports:
      - '6379:6379'

  ml-app:
    build: .
    ports:
      - '8501:8501'
    depends_on:
      - redis
    volumes:
      - ./app.py:/code/app.py
      - ./data.py:/code/data.py
      - ./models.py:/code/models.py
```

---

# Get started with the lab assignment!

---

## Set-up work environment

Walk through the steps in the course overview on Chamilo:

- [Software installation](https://chamilo.hogent.be/index.php?application=Chamilo%5CApplication%5CWeblcms&go=CourseViewer&course=58936&tool=LearningPath&tool_action=ComplexDisplay&publication=2196532&preview_content_object_id=7521644&learning_path_action=Viewer&child_id=357806)
- [Configuration](https://chamilo.hogent.be/index.php?application=Chamilo%5CApplication%5CWeblcms&go=CourseViewer&course=58936&tool=LearningPath&tool_action=ComplexDisplay&publication=2196532&preview_content_object_id=7521644&learning_path_action=Viewer&child_id=357819)
- [General guidelines](https://chamilo.hogent.be/index.php?application=Chamilo%5CApplication%5CWeblcms&go=CourseViewer&course=58936&tool=LearningPath&tool_action=ComplexDisplay&publication=2196532&preview_content_object_id=7521644&learning_path_action=Viewer&child_id=357826)

Then move on to the Docker assignment

---

## Docker lab assignment

```console
bash ./scripts/role-deps.sh ./dockerlab/ansible/site.yml
cd dockerlab
vagrant up
vagrant ssh
```

Follow the steps in the assignment <https://github.com/HOGENT-MLOps/mlops-labs/blob/main/assignment/01-docker.md>

Also keep a cheat sheet of important commands!

---

## Portainer

- Web UI for Docker
- Runs on the VM in a Docker container
  - Just like in SELab, remember?

Portainer UI resides at <https://192.168.56.20:9443/>

---

## Setup

- Docker, Docker Compose and Portainer are running on the VM
- Launch demo application in Docker container
- Expose the application to the host
- Attach a more robust database to the application
- Test the application
- Optimize the Docker image
- Push the Docker image to Docker Hub

---

# Reflection

---

## Lab setup vs reality

- Oversimplification
- Selfhosted vs managed database
- CI/CD pipeline for deployment and testing

---

## Best practices in the lab

- Package application with dependencies
- Don't expose database to the host
- Re-use Dockerfile
- Think about image layers
- Think about backups

          </textarea>
        </section>
      </div>
    </div>

    <script src="./dist/reveal.js"></script>

    <script src="./mermaid/dist/mermaid.min.js"></script>

    <script src="./plugin/markdown/markdown.js"></script>
    <script src="./plugin/highlight/highlight.js"></script>
    <script src="./plugin/zoom/zoom.js"></script>
    <script src="./plugin/notes/notes.js"></script>
    <script src="./plugin/math/math.js"></script>
    <script>
      function extend() {
        var target = {};
        for (var i = 0; i < arguments.length; i++) {
          var source = arguments[i];
          for (var key in source) {
            if (source.hasOwnProperty(key)) {
              target[key] = source[key];
            }
          }
        }
        return target;
      }

      // default options to init reveal.js
      var defaultOptions = {
        controls: true,
        progress: true,
        history: true,
        center: true,
        transition: 'default', // none/fade/slide/convex/concave/zoom
        slideNumber: true,
        highlight: {
          highlightOnLoad: false
        },
        plugins: [
          RevealMarkdown,
          RevealHighlight,
          RevealZoom,
          RevealNotes,
          RevealMath
        ]
      };

      // options from URL query string
      var queryOptions = Reveal().getQueryHash() || {};

      var options = extend(defaultOptions, {"width":1920,"height":1080,"transition":"fade","_":[],"static":true}, queryOptions);
    </script>


    <script>
      Reveal.initialize(options);
      Reveal.addEventListener('ready', function (event) {
        const blocks = Reveal.getRevealElement().querySelectorAll('pre code:not(.mermaid)');
        const hlp = Reveal.getPlugin('highlight');
        blocks.forEach(hlp.highlightBlock);
      });
    </script>

    <script>
      const mermaidOptions = extend({ startOnLoad: false }, {});
      mermaid.startOnLoad = false;
      mermaid.initialize(mermaidOptions);
      const cb = function (event) { mermaid.init(mermaidOptions, '.stack.present>.present pre code.mermaid'); };
      Reveal.addEventListener('ready', cb);
      Reveal.addEventListener('slidetransitionend', cb);
    </script>
  </body>
</html>
